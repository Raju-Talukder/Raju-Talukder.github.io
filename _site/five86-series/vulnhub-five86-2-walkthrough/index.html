<p>This is the last machine so far from this five86 series. This series proved to be interesting, offering numerous learning opportunities. Among the publicly available ports, FTP and the web server were present. However, the FTP was well-configured, with nothing initially available. The web application, when scanned using WPScanner, revealed some users and two valid user credential combinations. Upon obtaining the user credentials, logging into the web console and exploiting a simple file upload functionality provided the initial foothold. Password re-use granted the first user privilege. Achieving the second user privilege required executing an ARP poisoning attack. Finally, the third and last step to gain root access involved exploiting a misconfiguration in file super permissions.</p>

<h1 id="information-gathering">Information Gathering</h1>

<p>First, I want to start with Nmap to identify the open ports and their associated services. If possible, Nmap will also provide information about the service versions and the operating system. This is a good starting point when working with any assets.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">ports</span><span class="o">=</span><span class="si">$(</span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span><span class="o">=</span>1000 <span class="nt">-T4</span> <span class="nv">$IP</span> | <span class="nb">grep</span> ^[0-9] | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'/'</span> <span class="nt">-f</span> 1 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span> | <span class="nb">sed </span>s/,<span class="nv">$/</span>/<span class="si">)</span> <span class="p">;</span> nmap <span class="nt">-p</span><span class="nv">$ports</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-oN</span> nmap_service_scan <span class="nv">$IP</span>

PORT   STATE SERVICE VERSION
21/tcp open  ftp     ProFTPD 1.3.5e
80/tcp open  http    Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-title: Five86-2 &amp;#8211<span class="p">;</span> Just another WordPress site
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-generator: WordPress 5.1.4
Service Info: OS: Unix
</code></pre></div></div>

<p>According to the Nmap results, there are only two open ports on the system. Port 21 hosts an FTP service running ProFTPD version 1.3.5e, while port 80 serves a WordPress web application with WordPress version 5.1.4. The banners from both ports indicate that the operating system is Ubuntu.</p>

<h2 id="manual-inspection">Manual Inspection</h2>

<p>First i would like to check the FTP servers with default credentials.</p>

<p><img src="/assets/images/five86-2/1.png" alt="" /></p>

<p>The anonymous login did not worked. So, let‚Äôs move forward with the web application.</p>

<p><img src="/assets/images/five86-2/2.png" alt="" /></p>

<p>When I visited the IP address, I noticed issues with the CSS not rendering properly. Additionally, hovering over a link displayed the domain name as ‚Äòfive86-2‚Äô. To address this, I plan to add the corresponding entry to the hosts file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"192.168.197.136 five86-2"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
</code></pre></div></div>

<p>After adding the domain name to the hosts file, accessing the web application resulted in proper loading. However, I observed two additional links that, upon clicking, initiated the download of XML files.</p>

<p><img src="/assets/images/five86-2/3.png" alt="" /></p>

<p>The downloaded files turned out to be XML files with templates, which didn‚Äôt pique my interest. Consequently, I opted to skip these files and continue exploring.</p>

<p><img src="/assets/images/five86-2/4.png" alt="" /></p>

<p>Given that it‚Äôs a WordPress site, I decided to leverage WPScanner, which offers a password attack feature. To enhance the effectiveness of the attack, I attempted to generate a wordlist tailored to the web application. For this task, I employed the <code class="language-plaintext highlighter-rouge">cewl</code> tool.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cewl <span class="nt">-d</span> 3 <span class="nt">-w</span> password.txt http://five86-2
</code></pre></div></div>

<p>The generated word list isn‚Äôt extensive, and I‚Äôm uncertain if it will yield any valid credentials. In case it doesn‚Äôt produce any results, I plan to run the <code class="language-plaintext highlighter-rouge">rockyou</code> word list for a more comprehensive attempt.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wpscan <span class="nt">--enumerate</span> <span class="nt">--passwords</span> password.txt <span class="nt">--url</span> five86-2

<span class="o">[</span>+] URL: http://five86-2/ <span class="o">[</span>192.168.197.136]
<span class="o">[</span>+] Started: Fri Nov 10 22:11:22 2023

Interesting Finding<span class="o">(</span>s<span class="o">)</span>:

<span class="o">[</span>+] WordPress version 5.1.4 identified <span class="o">(</span>Insecure, released on 2019-12-12<span class="o">)</span><span class="nb">.</span>

<span class="o">[</span>+] WordPress theme <span class="k">in </span>use: twentynineteen

<span class="o">[</span>+] Enumerating Vulnerable Plugins <span class="o">(</span>via Passive Methods<span class="o">)</span>

<span class="o">[</span>i] No plugins Found.

<span class="o">[</span>i] No themes Found.

<span class="o">[</span>i] No Timthumbs Found.

<span class="o">[</span>i] No Config Backups Found.

<span class="o">[</span>i] No DB Exports Found.

<span class="o">[</span>i] No Medias Found.

<span class="o">[</span>i] User<span class="o">(</span>s<span class="o">)</span> Identified:

<span class="o">[</span>+] admin
<span class="o">[</span>+] barney
<span class="o">[</span>+] gillian
<span class="o">[</span>+] peter
<span class="o">[</span>+] stephen

<span class="o">[</span>i] No Valid Passwords Found.
</code></pre></div></div>

<p>As anticipated, WPScanner provided valid usernames, but unfortunately, no corresponding passwords. To address this, I intend to rerun WPScanner, this time utilizing the <code class="language-plaintext highlighter-rouge">rockyou</code> file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wpscan <span class="nt">--url</span> five86-2 <span class="nt">--passwords</span> /usr/share/wordlists/rockyou.txt
<span class="nt">---snip---</span>
<span class="o">[</span>+] Valid Combinations Found:
 | Username: barney, Password: spooky1
 | Username: stephen, Password: apollo1
</code></pre></div></div>

<p>This time, WPScanner yielded two valid credential combinations. I proceeded to attempt the login with the first set, using ‚Äòbarney‚Äô as the username, and it successfully granted access.</p>

<p><img src="/assets/images/five86-2/5.png" alt="" /></p>

<p>After a few examination i have discovered that there is a functionality of adding post where i can upload files as well. however we need to submit a zip file inside the zip there should be one html file.</p>

<p><img src="/assets/images/five86-2/6.png" alt="" /></p>

<p>Following the specified criteria, I generated a PHP file containing malicious code, along with an empty HTML file, and compiled them into a zip archive.</p>

<p><img src="/assets/images/five86-2/7.png" alt="" /></p>

<p>I uploaded the file using the default options, selecting ‚ÄòiFrame,‚Äô and it provided me with the file path of the HTML file.</p>

<p><img src="/assets/images/five86-2/8.png" alt="" /></p>

<p>Since my HTML file is located here, I expect that my PHP file should also be present in the same location.</p>

<p><strong>Creds</strong></p>

<aside>
üí° barney:spooky1
stephen:apollo1                                                                                                         paul:esomepasswford

</aside>

<h1 id="initial-foothold">Initial Foothold</h1>

<p>With knowledge of the PHP file path, I initiated a netcat listener to capture the reverse shell and visited the corresponding URL.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://five86-2//wp-content/uploads/articulate_uploads/shell3/shell.php
</code></pre></div></div>

<p><img src="/assets/images/five86-2/9.png" alt="" /></p>

<p>And i got the reverse shell as www-data.</p>

<h1 id="post-enumeration--privilege-escalation">Post Enumeration &amp; Privilege Escalation</h1>

<p>Since we obtained two valid user credentials from WPScanner, we can now proceed with a password re-use attack.</p>

<p><img src="/assets/images/five86-2/10.png" alt="" /></p>

<p>I attempted to use Barney‚Äôs credentials, but they were unsuccessful. However, Stephen‚Äôs credentials worked, granting me Stephen‚Äôs privileges. Upon checking sudo permissions for these users, it appears that the user is not permitted to run sudo. To gather more information, I examined the groups Stephen belongs to, and an interesting detail emerged: the ‚Äòpcap‚Äô group.</p>

<p><img src="/assets/images/five86-2/11.png" alt="" /></p>

<blockquote>
  <p>What is this 1009(pcap) ?                                                                                             Regarding <code class="language-plaintext highlighter-rouge">1009(pcap)</code>, it indicates that the user is a member of a group with the group ID (GID) of 1009, and the group name is ‚Äúpcap.‚Äù The ‚Äúpcap‚Äù group is often associated with network packet capture permissions, and members of this group may have elevated privileges for capturing network traffic.</p>

</blockquote>

<p>So i tried to find out all the interesting files capabilities and found the g <code class="language-plaintext highlighter-rouge">tcpdump</code> file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getcap <span class="nt">-r</span> / 2&gt;/dev/null
</code></pre></div></div>

<p><img src="/assets/images/five86-2/12.png" alt="" /></p>

<p>I‚Äôve identified all the running interfaces and aim to conduct an ARP poisoning attack to intercept data transmitted over any non-secure protocols. From the earlier Nmap results, I observed that the FTP port is open, and FTP is a non-secure protocol. There‚Äôs a possibility that if someone attempts to log in to the FTP protocol, we could capture their credentials in plain text.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-D</span>
</code></pre></div></div>

<p><img src="/assets/images/five86-2/13.png" alt="" /></p>

<p>I want to first dump the first interface.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-i</span> br-eca3858d86bf
</code></pre></div></div>

<p><img src="/assets/images/five86-2/14.png" alt="" /></p>

<p>I discovered the credentials for the user ‚Äòpaul‚Äô during the ARP poisoning attack. In this controlled scenario, there might be a script performing these login requests. However, in a real environment, we would need to wait for a genuine user to initiate such actions. With the ‚Äòpaul‚Äô user credentials in hand, I attempted to switch users, and the process succeeded.</p>

<p><img src="/assets/images/five86-2/15.png" alt="" /></p>

<p>After obtaining the shell as ‚Äòpaul,‚Äô I checked the sudo privileges and discovered that he can execute the service binary with sudo without entering a password.</p>

<p><img src="/assets/images/five86-2/16.png" alt="" /></p>

<p>While the primary purpose of the service binary is to manage services, including starting, stopping, restarting, and checking their status, I exploited it to launch /bin/bash. This action granted me the ‚Äòpeter‚Äô privilege.</p>

<p><img src="/assets/images/five86-2/17.png" alt="" /></p>

<p>Upon inspecting Peter‚Äôs sudo permissions, I discovered that he can execute the passwd command as root without requiring a password. Exploiting this, I changed the root user‚Äôs password and successfully logged in as root with the updated credentials.</p>

<p><img src="/assets/images/five86-2/18.png" alt="" /></p>
