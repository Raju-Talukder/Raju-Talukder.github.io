<p>There are two enabled HTTP services and one SSH service. One of the HTTP services, called â€˜opennetadmin,â€™ is outdated and has a publicly available exploit that provides the initial foothold. To escalate privileges for the first user access, find the â€˜.htpasswordâ€™ file, which contains the username and password hash with a clue. Abusing the misconfigured â€˜copyâ€™ binary gives us the second user access. For the third user access, check the mailbox where you will find the last userâ€™s credentials. At this point, we only need to find the secret game directory and execute a SUID binary to gain root access.</p>

<h1 id="information-gathering">Information Gathering</h1>

<p>First, I want to start with Nmap to identify the open ports and their associated services. If possible, Nmap will also provide information about the service versions and the operating system. This is a good starting point when working with any assets.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">ports</span><span class="o">=</span><span class="si">$(</span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span><span class="o">=</span>1000 <span class="nt">-T4</span> <span class="nv">$IP</span> | <span class="nb">grep</span> ^[0-9] | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'/'</span> <span class="nt">-f</span> 1 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span> | <span class="nb">sed </span>s/,<span class="nv">$/</span>/<span class="si">)</span> <span class="p">;</span> nmap <span class="nt">-p</span><span class="nv">$ports</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-oN</span> nmap_service_scan <span class="nv">$IP</span>
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 69:e6:3c:bf:72:f7:a0:00:f9:d9:f4:1d:68:e2:3c:bd <span class="o">(</span>RSA<span class="o">)</span>
|   256 45:9e:c7:1e:9f:5b:d3:ce:fc:17:56:f2:f6:42:ab:dc <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 ae:0a:9e:92:64:5f:86:20:c4:11:44:e0:58:32:e5:05 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp    open  http    Apache httpd 2.4.38 <span class="o">((</span>Debian<span class="o">))</span>
|_http-server-header: Apache/2.4.38 <span class="o">(</span>Debian<span class="o">)</span>
|_http-title: Site doesn<span class="s1">'t have a title (text/html).
| http-robots.txt: 1 disallowed entry 
|_/ona
10000/tcp open  http    MiniServ 1.920 (Webmin httpd)
|_http-title: Site doesn'</span>t have a title <span class="o">(</span>text/html<span class="p">;</span> <span class="nv">Charset</span><span class="o">=</span>iso-8859-1<span class="o">)</span><span class="nb">.</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<p>From the Nmap scan, we identified three open ports: SSH and two web servers. Port 80 has the â€˜robots.txtâ€™ file available, with a disallow entry. Port 10000 is also open, hosting Miniserv 1.920. Additionally, ports 22 and 80 confirmed that itâ€™s a Debian-based Linux system. I would like to begin by exploring the web servers, so letâ€™s dive into those.</p>

<h2 id="manual-inspection">Manual Inspection</h2>

<p><img src="/assets/images/five86-1/1.png" alt="" /></p>

<p>Port 80 hosts a Webmin login panel, and as of now, I donâ€™t have any credentials. I attempted the default credentials, but they did not work. Letâ€™s visit port 80 to explore further.</p>

<p><img src="/assets/images/five86-1/2.png" alt="" /></p>

<p>Here, weâ€™ve encountered a control panel that is displaying an outdated version warning. Letâ€™s search for publicly available exploits for this specific version, if any are available.</p>

<p><img src="/assets/images/five86-1/3.png" alt="" /></p>

<p>Through Searchsploit, I discovered three exploits, and two of them match the version number. One of the exploits is available in the Metasploit framework. While I attempted the other bash file, the shell proved to be unstable. As a result, Iâ€™m opting to try the Metasploit framework.</p>

<p><img src="/assets/images/five86-1/4.png" alt="" /></p>

<p>From the metasploit i found only one command injection exploit.</p>

<p><strong>Creds</strong></p>

<aside>
ðŸ’¡ douglas:$apr1$9fgG/hiM$BtsL9qpNHUlylaLxk81qY1

</aside>

<h1 id="initial-foothold">Initial Foothold</h1>

<p>I configured the â€˜rhostsâ€™ and â€˜lhosts,â€™ then executed the exploit. After a few moments, it provided me with a shell as â€˜www-dataâ€™.</p>

<p><img src="/assets/images/five86-1/5.png" alt="" /></p>

<h1 id="post-enumeration--privilege-escalation">Post Enumeration &amp; Privilege Escalation</h1>

<p>After obtaining the shell, I explored the file system, and within â€˜/var/www/html,â€™ I discovered the hidden â€˜.htaccessâ€™ file. This file contained a clue about the existence of a â€˜.htpasswdâ€™ file inside the â€˜/var/wwwâ€™ directory. Upon examining the â€˜.htpasswdâ€™ file, I found the â€˜douglasâ€™ user and his password MD5 hash, along with a clue on how to generate the password list for brute-force attacks.</p>

<p><img src="/assets/images/five86-1/6.png" alt="" /></p>

<p>Following the clue, I generated a wordlist using Crunch.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crunch 10 10 aefhrt <span class="o">&gt;</span> wordlist.txt
</code></pre></div></div>

<p>The wordlist is so big.</p>

<p><img src="/assets/images/five86-1/7.png" alt="" /></p>

<p>While searching for ideas to optimize the wordlist due to its size and the potential time it would take, I came across a blog post. From the walkthrough, I got the idea to make the wordlist shorter. Observing that not every character from the clue was present in each line, I revised the wordlist to ensure that every character appeared in every line.</p>

<p><img src="/assets/images/five86-1/8.png" alt="" /></p>

<p>I initially ran John using the smaller wordlist. If I didnâ€™t obtain any passwords, my plan was to then run it with the larger one. During that attempt, I would exclude the passwords containing characters I had already tried. This approach eliminates the need to check passwords that have already been tested. However, the password has already been decrypted using the small wordlist.</p>

<p><img src="/assets/images/five86-1/9.png" alt="" /></p>

<p>As the ssh port is available using this credential i just tried to login and it succeed.</p>

<p><img src="/assets/images/five86-1/10.png" alt="" /></p>

<p>Inside the Douglas userâ€™s home directory, there is nothing but a .ssh directory. However, when I tried checking the sudo permissions for this user, I discovered that the user can run the â€˜copyâ€™ command with sudo privileges as the â€˜jenâ€™ user. Exploiting this misconfiguration allows us to copy anything we want. The challenge lies in not knowing the exact file location since the â€˜copyâ€™ command doesnâ€™t provide that information. However, since there is SSH open, we can copy an authorized key into the â€˜jenâ€™ userâ€™s home directory, allowing us to obtain an SSH shell as â€˜jenâ€™.</p>

<p><img src="/assets/images/five86-1/11.png" alt="" /></p>

<p>Here i have copied the id_rsa.pub key inside the /tmp folder.</p>

<p><img src="/assets/images/five86-1/12.png" alt="" /></p>

<p>Here, I executed the command to transfer the RSA file into the â€˜jenâ€™ userâ€™s â€˜home/.sshâ€™ directory as â€˜authorized_keysâ€™ and attempted to SSH as â€˜jen.â€™ The operation succeeded, and I now have a shell as â€˜jenâ€™.</p>

<p><img src="/assets/images/five86-1/13.png" alt="" /></p>

<p>When I established the SSH connection, I noticed a message stating â€˜You have mail.â€™ Directly navigating to the mail directory, I discovered a mail file named â€˜jen.â€™ Inside the mail, I found the password for the â€˜mossâ€™ user.</p>

<p><img src="/assets/images/five86-1/14.png" alt="" /></p>

<p>I just changed the user as moss using the password found from the mail and found a hidden directory inside the moss users home directory called games.</p>

<p><img src="/assets/images/five86-1/15.png" alt="" /></p>

<p>Here are lots of games available but one of them has the SUID which could be the way for the root.</p>

<p><img src="/assets/images/five86-1/16.png" alt="" /></p>

<p>I just run the games and tried with random inputs but it gives me the root access every time so i assume there is nothing based on the input. And iâ€™m root now.</p>

<p><img src="/assets/images/five86-1/17.png" alt="" /></p>
