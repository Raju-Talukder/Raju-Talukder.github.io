<p>I personally found this box quite interesting. To gain the initial foothold, I ran WPScan with a password list, using <code class="language-plaintext highlighter-rouge">rockyou.txt</code> which led to the discovery of two valid user credentials for the web console. One of these users also had SSH access to the box. However, obtaining the shell wasnâ€™t enough; there was an additional step to escape the rbash shell. For root access, post-enumeration was crucial, as there were multiple ways to achieve it. Some methods were relatively straightforward, while others required additional research.</p>

<h1 id="information-gathering">Information Gathering</h1>

<p>First, I want to start with Nmap to identify the open ports and their associated services. If possible, Nmap will also provide information about the service versions and the operating system. This is a good starting point when working with any assets.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">ports</span><span class="o">=</span><span class="si">$(</span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span><span class="o">=</span>1000 <span class="nt">-T4</span> <span class="nv">$IP</span> | <span class="nb">grep</span> ^[0-9] | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'/'</span> <span class="nt">-f</span> 1 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span> | <span class="nb">sed </span>s/,<span class="nv">$/</span>/<span class="si">)</span> <span class="p">;</span> nmap <span class="nt">-p</span><span class="nv">$ports</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-oN</span> nmap/service_scan <span class="nv">$IP</span>

PORT      STATE SERVICE VERSION
21/tcp    open  ftp     ProFTPD
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   3072 d2:f6:53:1b:5a:49:7d:74:8d:44:f5:46:e3:93:29:d3 <span class="o">(</span>RSA<span class="o">)</span>
|   256 a6:83:6f:1b:9c:da:b4:41:8c:29:f4:ef:33:4b:20:e0 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 a6:5b:80:03:50:19:91:66:b6:c3:98:b8:c4:4f:5c:bd <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp    open  http    Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-title: Did not follow redirect to http://funbox.fritz.box/
| http-robots.txt: 1 disallowed entry 
|_/secret/
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
33060/tcp open  mysqlx?
| fingerprint-strings: 
|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: 
|     Invalid message<span class="s2">"
|_    HY000
</span></code></pre></div></div>

<p>From the Nmap results, we found that four ports are publicly accessible: 21 (FTP), 22 (SSH), 80 (HTTP), and 33060 (MySQL). The SSH and HTTP banners confirm that the operating system is Ubuntu. Additionally, the HTTP service redirects to a domain named â€˜funbox.fritz.boxâ€™. Letâ€™s add this to our hosts file first.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"10.10.10.5 funbox.fritz.box"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
</code></pre></div></div>

<p>Since we donâ€™t have any valid credentials, we couldnâ€™t access the SSH or MySQL servers. Therefore, I would like to proceed through the web server.</p>

<p><strong>Manual Inspection</strong></p>

<p><img src="/assets/images/fun-box-1/1.png" alt="" /></p>

<p>This is a WordPress application, and I havenâ€™t discovered any interactive elements on the web server, such as input boxes or dynamic pagination, except for the WordPress technology itself. Nmap also revealed a â€˜Disallowâ€™ entry in the robots.txt file; letâ€™s check it out.</p>

<p><img src="/assets/images/fun-box-1/2.png" alt="" /></p>

<p>The URL only displays a message: â€˜No secrets here. Try harder!â€™ Since this is a WordPress web application, I plan to run WPScan. However, considering the lack of substantial content during enumeration, generating a word-list based on this application seems unlikely to be fruitful. Instead, Iâ€™ll opt to run the rockyou.txt file for password brute-force attacks.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wpscan <span class="nt">--url</span> http://funbox.fritz.box/ <span class="nt">--enumerate</span> <span class="nt">--passwords</span> /usr/share/wordlists/rockyou.txt

<span class="o">[</span>+] URL: http://funbox.fritz.box/ <span class="o">[</span>10.10.10.5]
<span class="o">[</span>+] Started: Sat Nov 11 23:33:29 2023

Interesting Finding<span class="o">(</span>s<span class="o">)</span>:

<span class="o">[</span>+] WordPress version 5.4.2 identified <span class="o">(</span>Insecure, released on 2020-06-10<span class="o">)</span><span class="nb">.</span>
 
<span class="o">[</span>+] WordPress theme <span class="k">in </span>use: twentyseventeen
 
<span class="o">[</span>i] No plugins Found.

<span class="o">[</span>i] No Timthumbs Found.

<span class="o">[</span>i] No Config Backups Found.

<span class="o">[</span>i] No DB Exports Found.

<span class="o">[</span>i] No Medias Found.

<span class="o">[</span>i] User<span class="o">(</span>s<span class="o">)</span> Identified:

<span class="o">[</span>+] admin
 
<span class="o">[</span>+] joe

<span class="o">[</span>+] Performing password attack on Wp Login against 2 user/s
<span class="o">[</span>SUCCESS] - joe / 12345                                                                                                                                        
<span class="o">[</span>SUCCESS] - admin / iubire                                                                                                                                     
Trying admin / iubire Time: 00:00:09 &lt;                                                                                 <span class="o">&gt;</span> <span class="o">(</span>670 / 28689453<span class="o">)</span>  0.00%  ETA: ??:??:??

<span class="o">[!]</span> Valid Combinations Found:
 | Username: joe, Password: 12345
 | Username: admin, Password: iubire
</code></pre></div></div>

<p>WPScan revealed two valid user credential combinations. I tested both sets of credentials in the web console, and both were successful. Before proceeding with further enumeration on the web console, I plan to verify these credentials for both FTP and SSH access.</p>

<p><img src="/assets/images/fun-box-1/3.png" alt="" /></p>

<p>During the login attempt for FTP, the credentials for the â€˜joeâ€™ user worked successfully. However, the credentials for the â€˜adminâ€™ user did not grant access to the FTP service. Using the â€˜joeâ€™ user account, we discovered an mbox file and downloaded it to our local machine.</p>

<p><img src="/assets/images/fun-box-1/4.png" alt="" /></p>

<p>The mbox file appears to be a mail file, and within it, we discovered some interesting messages. One message mentioned â€˜funnyâ€™ as a possible username, and there was also a reference to a backup script, suggesting the existence of a script for backing up certain items. Additionally, thereâ€™s a warning message for Joe to change his password, with â€˜12345â€™ being recommended. However, we already know Joeâ€™s password. Letâ€™s attempt to SSH using the credentials for both Joe and Admin.</p>

<p><img src="/assets/images/fun-box-1/5.png" alt="" /></p>

<p><strong>Creds</strong></p>

<aside>
ðŸ’¡ joe:12345
admin:iubire

</aside>

<h1 id="initial-foothold">Initial Foothold</h1>

<p>The SSH login attempt with the â€˜adminâ€™ user was unsuccessful; however, the credentials for â€˜joeâ€™ were valid, providing me with the initial foothold for this box.</p>

<p><img src="/assets/images/fun-box-1/6.png" alt="" /></p>

<h1 id="post-enumeration--privilege-escalation">Post Enumeration &amp; Privilege Escalation</h1>

<p>After gaining the initial foothold, I discovered that the default shell is rbash, the restricted bash shell for Joe. To progress further, we need to find a way to escape this restricted shell.</p>

<p><img src="/assets/images/fun-box-1/7.png" alt="" /></p>

<p>Numerous techniques exist for escaping a jailed shell, but I opted for the vi editor technique. I executed the following commands, successfully escaping the restricted rbash shell.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi
:set <span class="nv">shell</span><span class="o">=</span>/bin/bash
:shell
</code></pre></div></div>

<p>After successfully escaping the rbash, I searched for the backup script and located a file owned by the â€˜funnyâ€™ user. Interestingly, the file is readable, writable, and executable for everyone. Although I checked for a cronjob for the â€˜joeâ€™ user and found none, since the file is owned by the â€˜funnyâ€™ user, I assume it is executed by the cron job of the â€˜funnyâ€™ user.</p>

<p><img src="/assets/images/fun-box-1/8.png" alt="" /></p>

<p>To confirm the existence of the cron job, I transferred pspy to the victim machine and executed it to monitor all input and output operations. After a few moments, I observed a cron job running periodically, executed by both the root and funny users.</p>

<p><img src="/assets/images/fun-box-1/9.png" alt="" /></p>

<p>Since I have write access, I modified the file and added a reverse shell code. I then started a listener on my Kali machine to capture the reverse shell.</p>

<p><img src="/assets/images/fun-box-1/10.png" alt="" /></p>

<p>After few moment i got the reverse shell as user funny.</p>

<p><img src="/assets/images/fun-box-1/11.png" alt="" /></p>

<p>Both the <code class="language-plaintext highlighter-rouge">root</code> and <code class="language-plaintext highlighter-rouge">funny</code> users have a cronjob to run this file, providing us with a reverse shell if executed. At this point, by removing the cronjob for <code class="language-plaintext highlighter-rouge">funny</code>, only the <code class="language-plaintext highlighter-rouge">root</code> user will execute the file, allowing us to gain root access. So, I went ahead and removed the cronjob for <code class="language-plaintext highlighter-rouge">funny</code>.</p>

<p><img src="/assets/images/fun-box-1/12.png" alt="" /></p>

<p>i Just modify the file once again to change the port and start a new listener for root. Within a few moment i got the reverse connection as root.</p>

<p><img src="/assets/images/fun-box-1/13.png" alt="" /></p>

<h1 id="bonus">Bonus</h1>

<p>While enumerating as the â€˜funnyâ€™ user, I noticed that this user is also a member of the â€˜lxdâ€™ group. This discovery is quite interesting. After some research, I found a publicly available privilege escalation exploit for this scenario. We could proceed with it.</p>

<p><img src="/assets/images/fun-box-1/14.png" alt="" /></p>

<p>I searched in the searchsploit database and found one result with a Bash script. However, there are some prerequisites for this attack to workâ€”specifically, the <code class="language-plaintext highlighter-rouge">lxd</code> and <code class="language-plaintext highlighter-rouge">lxc</code> components need to be installed on the machine.</p>

<p><img src="/assets/images/fun-box-1/15.png" alt="" /></p>

<p>The binaries are available inside the machine.</p>

<p><img src="/assets/images/fun-box-1/16.png" alt="" /></p>

<p>Although both binaries are present inside the box, Iâ€™ve decided not to pursue them since I already have root access. Skipping the â€˜funnyâ€™ userâ€™s part, with a bit of luck, we might catch the root reverse-shell on the first attempt. There are multiple ways to achieve root on this machine. I thoroughly enjoyed working on this machine.</p>
