<p>This box is very straightforward; there is nothing complex that we need to know about some tools. From the FTP, we obtained numerous zip files encrypted with passwords. We decrypted one user’s files password and found ‘id_rsa’ inside the zip, allowing SSH login into the box. To escalate privileges, we need to find out the users’ passwords, which are stored inside a history file.</p>

<h1 id="information-gathering">Information Gathering</h1>

<p>First, I want to start with Nmap to identify the open ports and their associated services. If possible, Nmap will also provide information about the service versions and the operating system. This is a good starting point when working with any assets.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">ports</span><span class="o">=</span><span class="si">$(</span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span><span class="o">=</span>1000 <span class="nt">-T4</span> <span class="nv">$IP</span> | <span class="nb">grep</span> ^[0-9] | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'/'</span> <span class="nt">-f</span> 1 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span> | <span class="nb">sed </span>s/,<span class="nv">$/</span>/<span class="si">)</span> <span class="p">;</span> nmap <span class="nt">-p</span><span class="nv">$ports</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-oN</span> nmap/service_scan <span class="nv">$IP</span>

PORT   STATE SERVICE VERSION
21/tcp open  ftp     ProFTPD 1.3.5e
| ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
| <span class="nt">-rw-rw-r--</span>   1 ftp      ftp          1477 Jul 25  2020 anna.zip
| <span class="nt">-rw-rw-r--</span>   1 ftp      ftp          1477 Jul 25  2020 ariel.zip
| <span class="nt">-rw-rw-r--</span>   1 ftp      ftp          1477 Jul 25  2020 bud.zip
| <span class="nt">-rw-rw-r--</span>   1 ftp      ftp          1477 Jul 25  2020 cathrine.zip
| <span class="nt">-rw-rw-r--</span>   1 ftp      ftp          1477 Jul 25  2020 homer.zip
| <span class="nt">-rw-rw-r--</span>   1 ftp      ftp          1477 Jul 25  2020 jessica.zip
| <span class="nt">-rw-rw-r--</span>   1 ftp      ftp          1477 Jul 25  2020 john.zip
| <span class="nt">-rw-rw-r--</span>   1 ftp      ftp          1477 Jul 25  2020 marge.zip
| <span class="nt">-rw-rw-r--</span>   1 ftp      ftp          1477 Jul 25  2020 miriam.zip
| <span class="nt">-r--r--r--</span>   1 ftp      ftp          1477 Jul 25  2020 tom.zip
| <span class="nt">-rw-r--r--</span>   1 ftp      ftp           170 Jan 10  2018 welcome.msg
|_-rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 zlatan.zip
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 f9:46:7d:fe:0c:4d:a9:7e:2d:77:74:0f:a2:51:72:51 <span class="o">(</span>RSA<span class="o">)</span>
|   256 15:00:46:67:80:9b:40:12:3a:0c:66:07:db:1d:18:47 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 75:ba:66:95:bb:0f:16:de:7e:7e:a1:7b:27:3b:b0:58 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
| http-robots.txt: 1 disallowed entry 
|_/logs/
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<p>From the Nmap output, we found three open ports. The first one is FTP, where anonymous login is allowed, and Nmap lists numerous zip files. The second and third ports are SSH and HTTP, respectively. The HTTP port displays a default Apache installation page. Let’s start enumerating one by one.</p>

<h2 id="manual-inspection"><strong>Manual Inspection</strong></h2>

<p>We already observed the anonymous login for FTP, and there are numerous files present. However, before we deep dive into that, I would like to run some backend reconnaissance. So, I will start from port 80 now.</p>

<h3 id="port-80">Port 80</h3>

<p><img src="/assets/images/funbox-2/1.png" alt="" /></p>

<p>This is just the default Apache2 installation page; I did not find anything here. I would like to run fuzzing to find out if there are any interesting files or directories present.</p>

<h3 id="fuzzing-directories">Fuzzing Directories</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-c</span> <span class="nt">-z</span> file,/usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt <span class="nt">--hc</span> 404 <span class="s2">"</span><span class="nv">$URL</span><span class="s2">"</span>

<span class="o">=====================================================================</span>
ID           Response   Lines    Word       Chars       Payload                                                                                      
<span class="o">=====================================================================</span>
000004227:   403        9 L      28 W       275 Ch      <span class="s2">"server-status"</span>                                                                              
000004255:   200        375 L    964 W      10918 Ch    <span class="s2">"http://10.10.10.8/"</span> 
</code></pre></div></div>

<h3 id="fuzzing-files">Fuzzing Files</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-c</span> <span class="nt">-z</span> file,/usr/share/seclists/Discovery/Web-Content/raft-large-files.txt <span class="nt">--hc</span> 404 <span class="s2">"</span><span class="nv">$URL</span><span class="s2">"</span>

<span class="o">=====================================================================</span>
ID           Response   Lines    Word       Chars       Payload                                                                                      
<span class="o">=====================================================================</span>
000000069:   200        375 L    964 W      10918 Ch    <span class="s2">"index.html"</span>                                                                                 
000000157:   403        9 L      28 W       275 Ch      <span class="s2">".htaccess"</span>                                                                                  
000000248:   200        1 L      2 W        17 Ch       <span class="s2">"robots.txt"</span>                                                                                 
000000379:   200        375 L    964 W      10918 Ch    <span class="s2">"."</span>                                                                                          
000000537:   403        9 L      28 W       275 Ch      <span class="s2">".html"</span>                                                                                      
000000806:   403        9 L      28 W       275 Ch      <span class="s2">".php"</span>                                                                                       
000001564:   403        9 L      28 W       275 Ch      <span class="s2">".htpasswd"</span>                                                                                  
000001830:   403        9 L      28 W       275 Ch      <span class="s2">".htm"</span>                                                                                                  
</code></pre></div></div>

<p>I didn’t find anything interesting; it seems they have only installed the Apache2 service, and no application is hosted there.</p>

<h3 id="port-21">Port 21</h3>

<p><img src="/assets/images/funbox-2/2.png" alt="" /></p>

<p>I have successfully logged in as an anonymous user through FTP, and there are many files present here.</p>

<p><img src="/assets/images/funbox-2/3.png" alt="" /></p>

<p><img src="/assets/images/funbox-2/4.png" alt="" /></p>

<p>I have downloaded all the files to my local machine to analyze them. There were two hidden files, and I just renamed the files to make them visible.</p>

<p><img src="/assets/images/funbox-2/5.png" alt="" /></p>

<p>The ‘users’ file and ‘admin’ file had the same content. However, the content of the ‘admin’ file was base64 encrypted, while the ‘users’ file’s content was in plain text format. Inside the content, they provided an idea about the zipped file data, and the password for the zip file was the old password. Currently, we don’t have any information about this password.</p>

<p>I used the Zip2John tool to create a file compatible with John the Ripper and started brute-forcing using the rockyou.txt file. Within a moment, I obtained the password for the ‘tom.zip’ file.</p>

<p><img src="/assets/images/funbox-2/6.png" alt="" /></p>

<p>Using the password, I successfully decrypted the file, and it’s an ‘id_rsa’ file. Now, with the ‘id_rsa’ file in hand and the SSH port open, we can utilize the SSH port to gain a real shell on this box.</p>

<p><img src="/assets/images/funbox-2/7.png" alt="" /></p>

<h1 id="initial-foothold">Initial Foothold</h1>

<p><img src="/assets/images/funbox-2/8.png" alt="" /></p>

<p>As I obtained the ‘id_rsa’ file, I used this private key instead of the user’s password. So, I passed the file and successfully logged into the machine.</p>

<h1 id="post-enumeration--privilege-escalation">Post Enumeration &amp; Privilege Escalation</h1>

<p><img src="/assets/images/funbox-2/9.png" alt="" /></p>

<p>I performed the ‘ls -la’ command to check the content present in the current directory. Here, I found a MySQL history file and a ‘sudo_as_admin_successful’ file. The ‘sudo_as_admin_successful’ file is an indication of the user’s sudo permission existence. Maybe it doesn’t have full sudo permissions, but at least it has the minimal amount. I performed ‘sudo -l’ to find out the permissions, but it asked for the password of this user. To find another way to get root or the ‘tom’ user’s password, I tried to open the ‘mysql_history’ file and encountered an error related to ‘rbash’.</p>

<p><img src="/assets/images/funbox-2/10.png" alt="" /></p>

<p>Rbash is a restricted bash environment where the user only gets some limited permissions. However, rbash is not very reliable because there are lots of techniques and tricks already available to escape rbash. In this scenario, I would like to go for the vi editor escaping technique.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi
:set <span class="nv">shell</span><span class="o">=</span>/bin/bash
:shell
</code></pre></div></div>

<p>It works every time. Now we can see the mysql_history file.</p>

<p><img src="/assets/images/funbox-2/11.png" alt="" /></p>

<p>inside the file i found a insert command where tom and a strings is visible so i just tried the strings a the password and it worked.</p>

<p><img src="/assets/images/funbox-2/12.png" alt="" /></p>

<p>We can see that the ‘tom’ user has full sudo permission on this box, and now that we have the user’s password, we can simply switch the user to root, and we are now root.</p>

<p><img src="/assets/images/funbox-2/13.png" alt="" /></p>
